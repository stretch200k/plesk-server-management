- name: Voeg hosts toe aan AWX met IP als naam en hostnaam als omschrijving
  hosts:all
  gather_facts: false
  vars:
    awx_url: "http://185.107.90.120:31151/api/v2"  # AWX API URL
    awx_username: "admin"  # Je AWX gebruikersnaam
    awx_password: "FWd2tp79RoY8NMqAWhQUxffXF0RG65T4"  # Je AWX wachtwoord of API-token
    inventory_name: "Managed Plesk Servers"  # De naam van je AWX-inventaris
  tasks:
    - name: Haal de lijst van hostnamen en IP-adressen op uit bestand
      slurp:
        src: "/var/www/vhosts/rafikihosting.nl/httpdocs/serverlijst.txt"  # Pas dit pad aan indien nodig
      register: file_content

    - name: Zet de inhoud van het bestand om naar tekst
      set_fact:
        ip_data: "{{ file_content.content | b64decode | splitlines() }}"

    - name: Parseer de IP-adressen en hostnamen
      set_fact:
        hosts: "{{ ip_data | map('split', ' ') | map('first') | list }}"
        descriptions: "{{ ip_data | map('split', ' ') | map('last') | list }}"

    - name: Voeg hosts toe aan AWX inventaris
      awx.awx.inventory_host:
        url: "{{ awx_url }}"
        username: "{{ awx_username }}"
        password: "{{ awx_password }}"
        inventory: "{{ inventory_name }}"
        host: "{{ item.0 }}"
        description: "{{ item.1 }}"
        state: present
      loop: "{{ hosts | zip(descriptions) | list }}"
