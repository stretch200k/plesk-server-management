---
- name: Installeer en activeer PHP-versies in Plesk
  hosts: all
  become: yes

  tasks:
    - name: Installeer PHP-versies via Plesk Installer
      shell: |
        plesk installer add --components php{{ item }}
      loop:
        - 8.4
        - 8.3
        - 8.2
        - 8.1
        - 8.0
        - 7.4
        - 7.3
        - 7.2
        - 7.1
        - 7.0

    - name: Haal lijst op van beschikbare PHP handlers
      shell: plesk bin php_handler --list
      register: php_handlers_output

    - name: Activeer PHP-versies als ze ge√Ønstalleerd zijn maar niet actief
      shell: |
        plesk bin php_handler --enable -id {{ item }}
      loop: "{{ php_handlers_output.stdout_lines | select('search', 'php[0-9]') | map('split') | map('first') | list }}"
      when: "'{{ item }}' not in php_handlers_output.stdout"
